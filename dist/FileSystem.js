import{BufferBuilder as e}from"@triforce-heroes/triforce-core";import{hash as n}from"./utils/hash.js";class t{constructor(e){this.name=e}}class i extends t{constructor(e,n){super(e),this.data=n}}class r{constructor(e,n){if(this.entries=[],this.identifier=e,this.name=n,4!==e.length)throw Error(`Invalid identifier: ${e}`)}createFile(e,n){this.entries.push(new i(e,n))}}export class FileSystem{createNode(e,n){let t=new r(e,n);return this.nodes.push(t),t}build(){let t=new e(1),i=new e(1),r=new e(1),s=new e(1),d=new e(1),g=new e(1),l=0;for(let t of this.nodes){let i=new e(1);for(let r of(i.writeString(t.identifier),i.writeUnsignedInt32(d.length),i.writeUnsignedInt16(n(t.name)),i.writeUnsignedInt16(t.entries.length),i.writeUnsignedInt32(s.length),d.writeNullTerminatedString(t.name),t.entries)){let t=new e(1);t.writeUnsignedInt16(l++),t.writeUnsignedInt16(n(r.name)),t.writeUnsignedInt16(4352),t.writeUnsignedInt16(d.length),t.writeUnsignedInt32(g.length),t.writeUnsignedInt32(r.data.length),t.writeUnsignedInt32(0),d.writeNullTerminatedString(r.name),g.push(r.data),s.push(t.build())}r.push(i.build())}let w=r.build(),h=s.build(),o=32+w.length,I=d.build(),U=o+h.length,u=g.build(),a=U+I.length;i.writeUnsignedInt32(this.nodes.length),i.writeUnsignedInt32(32),i.writeUnsignedInt32(l),i.writeUnsignedInt32(o),i.writeUnsignedInt32(I.length),i.writeUnsignedInt32(U),i.writeUnsignedInt32(0),i.writeUnsignedInt32(0);let c=i.build();return t.writeString("RARC"),t.writeUnsignedInt32(64+w.length+h.length+I.length+u.length),t.writeUnsignedInt32(32),t.writeUnsignedInt32(a),t.writeUnsignedInt32(u.length),t.writeUnsignedInt32(u.length),t.writeUnsignedInt32(0),t.writeUnsignedInt32(0),Buffer.concat([t.build(),c,w,h,I,u])}constructor(){this.nodes=[]}}